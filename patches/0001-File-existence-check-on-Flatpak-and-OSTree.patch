From 359354b9df04237f4e3df4e796a26437529bea0a Mon Sep 17 00:00:00 2001
From: Pier Luigi Fiorini <pierluigi.fiorini@liri.io>
Date: Wed, 24 May 2017 08:01:46 +0200
Subject: [PATCH] File existence check on Flatpak and OSTree

OSTree uses mtime 0 for all checkouts in order to maximize sharing of objects.
(i.e. two identical source files with different mtimes should result in the
same hardlinked file in the ostree checkout)

However Qbs thinks the file doesn't exist with mtime 0 so we need to rely
on a different way for OSTree.

OSTree nowadays is not only used by Flatpak, but also some Linux
distributions like Fedora Silverblue and QtOTA itself.

Change-Id: Ia2efc269dc6eb1862b4015bdcce7f9207f3a5efa
---
 src/lib/corelib/tools/fileinfo.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/lib/corelib/tools/fileinfo.cpp b/src/lib/corelib/tools/fileinfo.cpp
index b37f20382..15a8e8783 100644
--- a/src/lib/corelib/tools/fileinfo.cpp
+++ b/src/lib/corelib/tools/fileinfo.cpp
@@ -363,7 +363,7 @@ FileInfo::FileInfo(const QString &fileName)
 
 bool FileInfo::exists() const
 {
-    return m_stat.st_mtime != 0;
+    return m_stat.st_mode != 0;
 }
 
 FileTime FileInfo::lastModified() const
-- 
2.17.1

