{
    "id": "io.liri.Installer",
    "branch": "@@APP_BRANCH@@",
    "runtime": "io.liri.Platform",
    "runtime-version": "@@RUNTIME_BRANCH@@",
    "sdk": "io.liri.Sdk",
    "command": "run-calamares",
    "tags": [ "stable" ],
    "rename-desktop-file": "calamares.desktop",
    "finish-args": [
        "--share=ipc",
        "--socket=x11",
        "--socket=wayland",
        "--filesystem=host",
        "--device=dri",
        "--env=SESSION_MANAGER="
    ],
    "modules": [
        {
            "name": "yaml-cpp",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DBUILD_SHARED_LIBS=ON"
            ],
            "cleanup": ["/lib/libgmock*.so", "/lib/libgtest*.so"],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/jbeder/yaml-cpp/archive/yaml-cpp-0.6.2.tar.gz",
                    "sha512": "fea8ce0a20a00cbc75023d1db442edfcd32d0ac57a3c41b32ec8d56f87cc1d85d7dd7a923ce662f5d3a315f91a736d6be0d649997acd190915c1d68cc93795e4"
                }
            ]
        },
        {
            "name" : "polkit",
            "config-opts" : [
                "--disable-polkitd",
                "--disable-man-pages",
                "--disable-introspection"
            ],
            "rm-configure" : true,
            "cleanup" : [
                "/bin/*",
                "/etc/pam.d",
                "/etc/dbus-1",
                "/share/dbus-1/system-services/*",
                "/share/polkit-1/actions/*",
                "/lib/polkit-1"
            ],
            "sources" : [
                {
                    "type" : "archive",
                    "url" : "http://www.freedesktop.org/software/polkit/releases/polkit-0.113.tar.gz",
                    "sha256" : "e1c095093c654951f78f8618d427faf91cf62abdefed98de40ff65eca6413c81"
                },
                {
                    "type" : "patch",
                    "path" : "patches/polkit-build-Add-option-to-build-without-polkitd.patch"
                },
                {
                    "type" : "file",
                    "path" : "sources/polkit-autogen",
                    "dest-filename" : "autogen.sh"
                }
            ]
        },
        {
            "name": "polkit-qt5",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DCMAKE_INSTALL_LIBDIR=lib"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "git://anongit.kde.org/polkit-qt-1.git",
                    "branch": "cbecf60ac7b5c17cf37503d6675bf5542efbab29"
                }
            ]
        },
        {
          "name": "udev",
          "rm-configure": true,
          "config-opts": [
              "--disable-hwdb",
              "--disable-logging",
              "--disable-gudev",
              "--disable-introspection",
              "--disable-keymap",
              "--disable-mtd_probe"
          ],
          "cleanup": [
              "/include",
              "/lib/pkgconfig",
              "/man",
              "/share/aclocal",
              "/share/doc",
              "/share/gtk-doc",
              "/share/man",
              "/share/pkgconfig",
              "*.la",
              "*.a"
          ],
          "sources": [
              {
                  "type": "archive",
                  "url": "http://kernel.org/pub/linux/utils/kernel/hotplug/udev-175.tar.bz2",
                  "sha256": "4c7937fe5a1521316ea571188745b9a00a9fdf314228cffc53a7ba9e5968b7ab"
              },
              {
                  "type": "script",
                  "dest-filename": "autogen.sh",
                  "commands": [
                      "autoreconf -vfi"
                  ]
              }
          ]
        },
        {
            "name": "libatasmart",
            "sources": [
                {
                    "type": "archive",
                    "url": "http://0pointer.de/public/libatasmart-0.19.tar.xz",
                    "md5": "53afe2b155c36f658e121fe6def33e77"
                }
            ]
        },
        {
            "name": "util-linux",
            "cleanup": [
                "/bin",
                "/share",
                "*.a",
                "*.la"
            ],
            "config-opts": [
                "--disable-all-programs",
                "--enable-libuuid",
                "--enable-libblkid",
                "--with-bashcompletiondir=/app/share/bash-completion",
                "--without-util"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://mirrors.edge.kernel.org/pub/linux/utils/util-linux/v2.32/util-linux-2.32.tar.xz",
                    "sha256": "6c7397abc764e32e8159c2e96042874a190303e77adceb4ac5bd502a272a4734"
                }
            ]
        }, 
        {
            "name": "device-mapper",
            "cleanup": ["/sbin", "/share"],
            "config-opts": [
                "--disable-dmeventd",
                "--disable-lvmetad",
                "--disable-lvmpolld",
                "--disable-readline",
                "--disable-udev_rules",
                "--disable-udev_sync",
                "--disable-use-lvmetad",
                "--with-cache=internal",
                "--with-thin=internal",
                "--with-udev-prefix=/app",
                "--with-systemdsystemunitdir=/app/lib/systemd/system"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://mirrors.kernel.org/sourceware/lvm2/releases/LVM2.2.02.177.tgz",
                    "sha256": "4025a23ec9b15c2cb7486d151c29dc953b75efc4d452cfe9dbbc7c0fac8e80f2"
                }
            ]
        },
        {
            "name": "parted",
            "config-opts": [
                "--disable-device-mapper",
                "--disable-mtrace",
                "--disable-rpath"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://ftp.gnu.org/gnu/parted/parted-3.2.tar.xz",
                    "sha256": "858b589c22297cacdf437f3baff6f04b333087521ab274f7ab677cb8c6bb78e4"
                }
            ]
        },
        {
            "name": "kpmcore",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DCMAKE_INSTALL_LIBDIR=lib",
                "-DBUILD_TESTING=OFF"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://download.kde.org/stable/kpmcore/3.3.0/src/kpmcore-3.3.0.tar.xz",
                    "sha256": "b8d6fa3c0d89feebf690a424d98ad36acb2438b1099a5b620ee349989d04db68"
                }
            ]
        },
        {
            "name": "calamares",
            "buildsystem": "cmake-ninja",
            "config-opts": [
                "-DCMAKE_INSTALL_LIBDIR=lib",
                "-DSKIP_MODULES=\"dummycpp dummyprocess dummypython dummypythonqt\""
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/calamares/calamares/releases/download/v3.1.12/calamares-3.1.12.tar.gz",
                    "sha256": "86551d55d6aa719382eb9a58406b60c5cd4cae5c5c17d84ad6ab3e0199e5a94c"
                }
            ]
        },
        {
            "name": "calamares-branding",
            "buildsystem": "simple",
            "build-commands": [
                "./qbs-configure",
                "./qbs-build qbs.buildVariant:debug modules.qbs.installRoot:/ modules.lirideployment.prefix:/app"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "git://github.com/lirios/calamares-branding.git",
                    "branch": "feature/script"
                },
                {
                    "dest-filename": "qbs-configure",
                    "path": "sources/qbs-configure",
                    "type": "file"
                },
                {
                    "dest-filename": "qbs-build",
                    "path": "sources/qbs-build",
                    "type": "file"
                }
            ],
            "post-install": [
                "sed -i -e 's/Exec=calamares/Exec=run-calamares/g' /app/share/applications/calamares.desktop"
            ]
        }
    ]
}
